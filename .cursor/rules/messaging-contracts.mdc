---
description: Messaging system contracts and enforceable requirements
globs:
  - "src/services/messaging/**"
  - "agent_workspaces/**/inbox/**"
alwaysApply: false
---

## **üì¨ MESSAGING SYSTEM CONTRACTS**

### **Inbox Management**
- **Primary communication channel**: `agent_workspaces/{Agent-X}/inbox/`
- **Message format**: Markdown files with headers and metadata
- **File naming**: `CAPTAIN_MESSAGE_{timestamp}_{message_id}.md`

### **Message Headers** (required):
```
# üö® CAPTAIN MESSAGE - {TYPE}
**From**: {sender}
**To**: {recipient}
**Priority**: {priority}
**Message ID**: {message_id}
**Timestamp**: {timestamp}
```

### **Messaging CLI Requirements**
- ‚úÖ **Check your inbox first.** Before acting or replying, read all new messages in `agent_workspaces/{Agent-X}/inbox/` so you always act on the latest instructions.
- ‚úÖ **Use the unified messaging CLI for A2A and A2C communication:**
  - Agent-to-Agent (A2A) reply:
    ```bash
    python -m src.services.messaging_cli --message "<your message>" --agent <TARGET_AGENT> --type text --category a2a
    ```
  - Agent-to-Captain (A2C) status / completion / blocker update:
    ```bash
    python -m src.services.messaging_cli --message "<status / completion / blockers>" --agent Agent-4 --type text --category a2c
    ```
- ‚úÖ **Follow the shared templates.** Do not hand-craft headers like `[A2A]` or `[CAPTAIN]` in raw Markdown. Rely on the templates in `src/core/messaging_template_texts.py` (they already include `From/To/Priority/Message ID/Timestamp` and "How to respond" guidance).
- ‚úÖ **Every reply must contain substance:**
  - What you did (or will do next)
  - What changed (links / evidence)
  - Any blockers and your proposed next steps
- ‚ùå **Do not create new ad-hoc `send_*` messaging scripts.** If you need automation, wrap the official CLI or call `src.core.messaging_core.send_message` with the standard templates.

### **Related Rules**
- CLI flag validation: `.cursor/rules/messaging/cli-flags.mdc`
- PyAutoGUI operations: `.cursor/rules/messaging/pyautogui-operations.mdc`
