---
description: A+++ Session Closure Standard - Required format for all session closures
globs:
  - "**/session_closures/**/*.md"
  - "**/passdown.json"
  - "**/*closure*.md"
alwaysApply: true
---

# A+++ Session Closure Standard

## Purpose

Session closures must be **internally closed, publicly explainable, and handoff-ready**. This standard ensures:
- Zero context loss between sessions
- Build-in-public readiness
- Queryable truth in Swarm Brain
- No work leakage across sessions

## HARD RULES (NON-NEGOTIABLE)

**When in doubt, choose NON-DESTRUCTIVE verification over cleanup.**

### ‚ùå SHARED WORKSPACE SAFETY (CRITICAL)
**Destructive git commands are FORBIDDEN in shared workspaces:**
- ‚ùå `git clean -fd`
- ‚ùå `git restore .`
- ‚ùå `rm -rf` on repo paths
- ‚ùå Deleting untracked files (they may belong to other agents)

**If untracked files exist outside agent scope ‚Üí Status MUST be üü° Blocked**

### Agent Ownership Boundary
**Agent may modify ONLY:**
- `src/` modules explicitly owned by this agent
- `agent_workspaces/Agent-X/**` (own workspace only)
- Files explicitly listed in task assignment

**Any change outside scope requires explicit Captain authorization.**

### Git Safety Rules
- Only stage files listed in **Artifacts Created / Updated**
- Use explicit paths: `git add <file1> <file2>`
- Do NOT stage or delete unrelated files
- Any additional file change ‚Üí Status MUST be üü° Blocked

### Working Tree Verification
- Run `git status` to observe state
- If untracked or modified files exist OUTSIDE agent scope ‚Üí üü° Blocked
- Do NOT delete files to achieve cleanliness
- Cleanliness must be **observed**, not **enforced**

### Destructive-Action Escalation Gate
**If closure requires file deletion, cleanup, or reset:**
- STOP immediately
- Emit üü° Blocked
- State exact conflict
- Await Captain or human arbitration

## Required Format

Every session closure MUST follow this exact structure:

```markdown
- **Task:** [Brief task description]
- **Project:** [Project/repo name]

- **Actions Taken:**
  - [Bullet 1: factual action]
  - [Bullet 2: factual action]

- **Artifacts Created / Updated:**
  - [Exact file path 1]
  - [Exact file path 2]

- **Verification:**
  - [Proof/evidence bullet 1]
  - [Proof/evidence bullet 2]

- **Public Build Signal:**
  [Single line, human-readable description of what changed]

- **Git Commit:**
  [Commit hash if committed, or "Not committed" if not]

- **Git Push:**
  [Push status: "Pushed to [branch]" or "Not pushed"]

- **Website Blogging:**
  [Blog post URL if published, or "Not published" if not applicable]

- **Status:**
  ‚úÖ Ready
  OR
  üü° Blocked (specific reason)
```

## Required Fields

### Task
- Brief, specific description of what was accomplished
- Must be factual, not speculative

### Project
- Project or repository name
- Enables proper categorization

### Actions Taken
- Bullet list of factual actions
- No narration, no summaries
- Each bullet = one completed action
- **Forbidden verbs:** responded, synced, reviewed, checked, coordinated, discussed, analyzed, investigated, explored, considered
- **Allowed actions:** code changes (added, removed, modified), files created/updated, commands executed, state changes

### Artifacts Created / Updated
- **Exact file paths only**
- No descriptions, no explanations
- Must be verifiable paths

### Verification
- **Proof that work was completed**
- Each bullet MUST include at least ONE proof token:
  - Command output (exact text or summary)
  - Commit hash
  - Message ID / timestamp
  - File checksum or line count
  - HTTP status code
  - Test pass count
- "Verified via review" or similar phrasing is INVALID
- If no mechanical proof exists, status = üü° Blocked

### Public Build Signal
- **ONE sentence only**
- Human-readable description
- Suitable for Discord, changelogs, build feeds
- Describes what changed, not what will change

### Git Commit
- Commit hash if work was committed to git
- "Not committed" if work is not yet committed

### Git Push
- Push status: "Pushed to [branch]" if changes were pushed
- "Not pushed" if changes are committed but not pushed

### Website Blogging
- Blog post URL if a blog post was published about this work
- "Not published" if blogging is not applicable to this work

### Status
- MUST include emoji exactly as shown:
  - ‚úÖ Ready (work complete, verified)
  - üü° Blocked (specific blocker reason)
- Missing emoji = INVALID
- Any formatting deviation = üü° Blocked

### passdown.json Requirement
- passdown.json MUST be accompanied by proof:
  - Inlined content (for small files), OR
  - Git diff reference (commit hash), OR
  - Checksum (md5/sha256)
- Claiming "passdown.json updated" without proof = INVALID

### Closure Improvement (REQUIRED)
- Must complete exactly ONE:
  - a) Create small utility tool (150 lines max)
  - b) Define protocol (10 lines max)
  - c) Improve documentation (delete/merge/deduplicate)
- To skip, MUST provide:
  - Gap evaluated
  - Reason non-actionable
- "Skipped - no gap identified" alone is INVALID

## Forbidden Elements

### ‚ùå "Next Steps"
**Never include:**
- "Next steps"
- "TODO"
- "Future work"
- "Remaining tasks"
- Any future-facing language

**Why:** Closure = end of time horizon. Future work belongs in passdown.json or new task creation.

### ‚ùå Narration / Summaries
**Never include:**
- Long narrative summaries
- "We did X, then Y, then Z" storytelling
- Background context (belongs in devlog)

**Why:** Closure is a signal, not documentation. Documentation belongs in devlogs.

### ‚ùå Speculation
**Never include:**
- "Should work"
- "May need"
- "Could be"
- "Might require"

**Why:** Closure must be deterministic. If uncertain, status = üü° Blocked.

### ‚ùå Progress Reports
**Never include:**
- "Made progress on"
- "Started working on"
- "Partially completed"

**Why:** Closure = completion. Progress reports belong in status.json.

### ‚ùå Process Narration
**Forbidden verbs in Actions Taken:**
- responded, synced, reviewed, checked
- coordinated, discussed, analyzed
- investigated, explored, considered

**Why:** Actions describe system changes, not agent activities. Process narration is fluff.

**Actions must describe ONLY:**
- Code changes (added, removed, modified)
- Files created/updated
- Commands executed
- State changes

### ‚ùå Workspace Cleanup Actions
**Never include or perform:**
- "Cleaned up workspace"
- "Normalized repo state"
- "Aligned local state"
- Deleting files to achieve cleanliness
- Any janitorial deletion outside owned files

**Why:** Closure ‚â† janitorial duty. Cleanup destroys other agents' work.

## Correct vs Incorrect Examples

### ‚úÖ CORRECT

```markdown
- **Task:** Trading Dashboard Focus + Market Data Infrastructure
- **Project:** TradingRobotPlug / WordPress Theme

- **Actions Taken:**
  - Restricted dashboard symbols to TSLA, QQQ, SPY, NVDA
  - Implemented 5-minute market data collection via WP-Cron
  - Created persistent storage table wp_trp_stock_data
  - Deployed 16 files to production via SFTP

- **Artifacts Created / Updated:**
  - inc/dashboard-api.php
  - inc/charts-api.php
  - wp_trp_stock_data (database table)
  - REST: /wp-json/tradingrobotplug/v1/stock-data

- **Verification:**
  - ‚úÖ Deployed 16 files (all successful, 0 failures)
  - ‚úÖ Database table creation function exists
  - ‚úÖ Cron schedule registered
  - ‚úÖ REST endpoints registered

- **Public Build Signal:**
  Trading dashboard now tracks TSLA, QQQ, SPY, and NVDA with live 5-minute market data accessible to all trading plugins via REST API.

- **Git Commit:**
  abc123def456

- **Git Push:**
  Pushed to main

- **Website Blogging:**
  Not published

- **Status:**
  ‚úÖ Ready
```

### ‚ùå INCORRECT

```markdown
## Summary

We worked on the trading dashboard and made good progress. We updated the symbols to focus on TSLA, QQQ, SPY, and NVDA. We also implemented data collection and created a database table.

## Next Steps
- Test the cron job
- Integrate with trading plugins
- Monitor data collection

## Status
In progress
```

**Violations:**
- ‚ùå Narrative summary (forbidden)
- ‚ùå "Next Steps" section (forbidden)
- ‚ùå "Made progress" (progress report, not closure)
- ‚ùå No verification block (required)
- ‚ùå No public build signal (required)
- ‚ùå "In progress" status (closure = complete)

## Integration Points

### Workspace Rules
- This rule auto-applies to all agents
- Cursor exposes rules automatically
- Agents cannot claim ignorance

### Canonical Prompt
- `src/services/onboarding/soft/canonical_closure_prompt.py`
- Must match this standard exactly
- No contradictions allowed

### Validation Tool
- `tools/validate_closure_format.py`
- Validates closures before acceptance
- Catches violations automatically

### Template
- `templates/session-closure-template.md`
- Copy and fill in
- Reduces errors

## Enforcement

### Pre-Commit
- Validation tool runs automatically
- Blocks commits with invalid closures

### CI/CD
- Validates closure format in pipelines
- Fails build on violations

### Onboarding
- New agents learn standard immediately
- References in onboarding docs

## Why This Matters

**Without A++ closure:**
- Context loss between sessions
- Unclear what's actually done
- "Next steps" leak across sessions
- Build-in-public feeds are noisy

**With A++ closure:**
- Zero context loss
- Deterministic state
- Clean build feeds
- Queryable truth

## References

- Canonical Prompt: `src/services/onboarding/soft/canonical_closure_prompt.py`
- Validation Tool: `tools/validate_closure_format.py`
- Template: `templates/session-closure-template.md`
- Example: `agent_workspaces/Agent-4/session_closures/2025-12-26_trading_dashboard_closure.md`
