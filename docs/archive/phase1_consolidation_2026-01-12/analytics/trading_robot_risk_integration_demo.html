<!--
    Trading Robot Risk Dashboard Integration Demo
    ============================================

    Demonstrates how trading plugins integrate with real-time risk metrics
    from the WebSocket server for coordinated risk monitoring.

    Navigation References:
    ‚îú‚îÄ‚îÄ Risk WebSocket Server ‚Üí src/services/risk_analytics/risk_websocket_server.py
    ‚îú‚îÄ‚îÄ Risk Dashboard Integration ‚Üí src/web/static/js/trading-robot/risk-dashboard-integration.js
    ‚îú‚îÄ‚îÄ Trading Dashboard ‚Üí src/web/static/js/trading-robot/trading-dashboard.js
    ‚îú‚îÄ‚îÄ Standalone Dashboard ‚Üí docs/analytics/risk_dashboard.html

    Integration Features:
    - Real-time risk metrics in trading dashboard
    - Risk alerts integrated with trading interface
    - Risk-adjusted portfolio calculations
    - Coordinated risk monitoring across trading plugins
-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Robot - Risk Dashboard Integration Demo</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .integration-status {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-weight: 500;
        }

        .integration-status.connected {
            background: rgba(46, 204, 113, 0.8);
            color: white;
        }

        .integration-status.disconnected {
            background: rgba(231, 76, 60, 0.8);
            color: white;
        }

        .demo-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .demo-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .demo-card h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .risk-indicators {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .risk-indicator {
            text-align: center;
            padding: 15px;
            border-radius: 8px;
            background: #f8f9fa;
        }

        .risk-indicator.high-risk {
            background: #fee;
            border-left: 4px solid #e74c3c;
        }

        .risk-indicator.medium-risk {
            background: #fff3cd;
            border-left: 4px solid #f39c12;
        }

        .risk-indicator.critical-risk {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .risk-indicator.normal-risk {
            background: #d4edda;
            border-left: 4px solid #28a745;
        }

        .indicator-label {
            font-size: 0.8rem;
            color: #666;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .indicator-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: #2c3e50;
        }

        .trading-risk-alerts {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
        }

        .trading-risk-alerts h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .risk-alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .risk-alert.critical {
            background: #f8d7da;
            border-left: 4px solid #dc3545;
        }

        .risk-alert.high {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }

        .risk-alert.medium {
            background: #d1ecf1;
            border-left: 4px solid #17a2b8;
        }

        .alert-icon {
            font-size: 1.2rem;
        }

        .alert-message {
            flex: 1;
            font-weight: 500;
        }

        .alert-time {
            font-size: 0.8rem;
            color: #666;
        }

        .portfolio-risk-summary {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            text-align: center;
        }

        .portfolio-risk-summary h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .risk-score {
            font-size: 3rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .risk-score.high-risk {
            color: #e74c3c;
        }

        .risk-score.medium-risk {
            color: #f39c12;
        }

        .risk-score.low-risk {
            color: #27ae60;
        }

        .risk-score-label {
            font-size: 0.9rem;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .integration-info {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            backdrop-filter: blur(10px);
            margin-top: 20px;
        }

        .integration-info h3 {
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.2rem;
        }

        .integration-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
        }

        .feature {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            text-align: center;
        }

        .feature-icon {
            font-size: 2rem;
            margin-bottom: 10px;
        }

        .feature-title {
            font-weight: bold;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .feature-description {
            font-size: 0.9rem;
            color: #666;
        }

        .footer {
            text-align: center;
            margin-top: 30px;
            color: rgba(255,255,255,0.7);
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .demo-grid {
                grid-template-columns: 1fr;
            }

            .risk-indicators {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ü§ñ Trading Robot Risk Integration</h1>
            <div id="integration-status" class="integration-status disconnected">
                Connecting to Risk WebSocket...
            </div>
        </div>

        <div class="demo-grid">
            <div class="demo-card">
                <h3>Real-time Risk Metrics</h3>
                <div class="risk-indicators">
                    <div class="risk-indicator" id="trading-var-indicator">
                        <div class="indicator-label">Value at Risk (95%)</div>
                        <div class="indicator-value">--</div>
                    </div>
                    <div class="risk-indicator" id="trading-sharpe-indicator">
                        <div class="indicator-label">Sharpe Ratio</div>
                        <div class="indicator-value">--</div>
                    </div>
                    <div class="risk-indicator" id="trading-drawdown-indicator">
                        <div class="indicator-label">Max Drawdown</div>
                        <div class="indicator-value">--</div>
                    </div>
                </div>
            </div>

            <div class="portfolio-risk-summary">
                <h3>Portfolio Risk Score</h3>
                <div id="portfolio-risk-score" class="risk-score">--</div>
                <div class="risk-score-label">Risk Level (1-10 Scale)</div>
            </div>
        </div>

        <div class="trading-risk-alerts">
            <h3>üö® Active Risk Alerts</h3>
            <div id="trading-risk-alerts">
                <div class="risk-alert medium">
                    <span class="alert-icon">‚ÑπÔ∏è</span>
                    <span class="alert-message">Risk dashboard integration active - monitoring live metrics</span>
                    <span class="alert-time">--:--:--</span>
                </div>
            </div>
        </div>

        <div class="integration-info">
            <h3>üîó Integration Features</h3>
            <div class="integration-features">
                <div class="feature">
                    <div class="feature-icon">üìä</div>
                    <div class="feature-title">Live Risk Metrics</div>
                    <div class="feature-description">Real-time VaR, Sharpe ratio, and drawdown monitoring in trading interface</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">üö®</div>
                    <div class="feature-title">Risk Alerts</div>
                    <div class="feature-description">Automated alerts for risk threshold breaches integrated with trading dashboard</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">üìà</div>
                    <div class="feature-title">Risk-Adjusted Calculations</div>
                    <div class="feature-description">Portfolio valuations adjusted for risk metrics and scoring</div>
                </div>
                <div class="feature">
                    <div class="feature-icon">üîÑ</div>
                    <div class="feature-title">WebSocket Streaming</div>
                    <div class="feature-description">1Hz real-time updates from dedicated risk analytics WebSocket server</div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Trading Robot Risk Dashboard Integration | Real-time Risk Monitoring | TradingRobotPlug Platform</p>
        </div>
    </div>

    <script type="module">
        import { RiskDashboardIntegration } from './src/web/static/js/trading-robot/risk-dashboard-integration.js';

        // Initialize risk dashboard integration
        const riskIntegration = new RiskDashboardIntegration();

        // Status indicator
        const statusElement = document.getElementById('integration-status');

        // Initialize integration
        async function initializeDemo() {
            try {
                await riskIntegration.initialize();
                statusElement.textContent = 'üü¢ Risk Integration Active';
                statusElement.className = 'integration-status connected';
            } catch (error) {
                console.error('Failed to initialize risk integration:', error);
                statusElement.textContent = '‚ùå Integration Failed';
                statusElement.className = 'integration-status disconnected';
            }
        }

        // Subscribe to risk updates
        riskIntegration.subscribe((update) => {
            if (update.type === 'risk_update') {
                updateRiskDisplay(update.metrics, update.alerts);
            }
        });

        // Update risk metrics display
        function updateRiskDisplay(metrics, alerts) {
            // Update risk indicators
            updateRiskIndicator('trading-var-indicator', (metrics.var_95 * 100).toFixed(1) + '%', metrics.var_95 > 0.20 ? 'high-risk' : 'normal-risk');
            updateRiskIndicator('trading-sharpe-indicator', metrics.sharpe_ratio.toFixed(2), metrics.sharpe_ratio < 1.0 ? 'medium-risk' : 'normal-risk');
            updateRiskIndicator('trading-drawdown-indicator', (metrics.max_drawdown * 100).toFixed(1) + '%', metrics.max_drawdown > 0.10 ? 'critical-risk' : 'normal-risk');

            // Update portfolio risk score
            const riskScore = calculateRiskScore(metrics);
            const scoreElement = document.getElementById('portfolio-risk-score');
            scoreElement.textContent = riskScore.toFixed(1);
            scoreElement.className = `risk-score ${riskScore > 7 ? 'high-risk' : riskScore > 4 ? 'medium-risk' : 'low-risk'}`;

            // Update alerts
            updateAlertsDisplay(alerts);
        }

        // Update individual risk indicator
        function updateRiskIndicator(elementId, value, riskClass) {
            const element = document.getElementById(elementId);
            if (element) {
                element.querySelector('.indicator-value').textContent = value;
                element.className = `risk-indicator ${riskClass}`;
            }
        }

        // Calculate risk score (1-10 scale)
        function calculateRiskScore(metrics) {
            let score = 0;

            // VaR contribution
            if (metrics.var_95 > 0.25) score += 3;
            else if (metrics.var_95 > 0.15) score += 2;
            else if (metrics.var_95 > 0.10) score += 1;

            // Sharpe ratio contribution
            if (metrics.sharpe_ratio < 0.5) score += 3;
            else if (metrics.sharpe_ratio < 1.0) score += 2;
            else if (metrics.sharpe_ratio < 1.5) score += 1;

            // Drawdown contribution
            if (metrics.max_drawdown > 0.15) score += 4;
            else if (metrics.max_drawdown > 0.10) score += 3;
            else if (metrics.max_drawdown > 0.05) score += 2;
            else if (metrics.max_drawdown > 0.02) score += 1;

            return Math.min(10, Math.max(1, score));
        }

        // Update alerts display
        function updateAlertsDisplay(alerts) {
            const container = document.getElementById('trading-risk-alerts');

            if (!alerts || alerts.length === 0) {
                container.innerHTML = '<div class="risk-alert medium"><span class="alert-icon">‚úÖ</span><span class="alert-message">No active risk alerts</span><span class="alert-time">' + new Date().toLocaleTimeString() + '</span></div>';
                return;
            }

            container.innerHTML = alerts.map(alert => `
                <div class="risk-alert ${alert.level}">
                    <span class="alert-icon">${getAlertIcon(alert.level)}</span>
                    <span class="alert-message">${alert.message}</span>
                    <span class="alert-time">${new Date(alert.timestamp).toLocaleTimeString()}</span>
                </div>
            `).join('');
        }

        // Get alert icon
        function getAlertIcon(level) {
            switch (level) {
                case 'critical': return 'üö®';
                case 'high': return '‚ö†Ô∏è';
                case 'medium': return '‚ÑπÔ∏è';
                default: return 'üîî';
            }
        }

        // Initialize demo when page loads
        document.addEventListener('DOMContentLoaded', initializeDemo);

        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            riskIntegration.cleanup();
        });
    </script>
</body>
</html>