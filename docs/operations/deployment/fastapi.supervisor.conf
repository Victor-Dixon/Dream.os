; FastAPI Supervisor Configuration
; Place in /etc/supervisor/conf.d/fastapi.conf
; Usage: sudo supervisorctl reread && sudo supervisorctl update && sudo supervisorctl start fastapi

[program:fastapi]
command=/path/to/venv/bin/uvicorn src.api.main:app --host 0.0.0.0 --port 8000 --workers 4
directory=/path/to/Agent_Cellphone_V2_Repository
user=www-data
group=www-data
autostart=true
autorestart=true
startretries=3
startsecs=10

; Environment variables
environment=
    PATH="/path/to/venv/bin",
    PYTHONUNBUFFERED="1"

; Load .env file (supervisor doesn't support EnvironmentFile, so load manually or use env program)
; Alternative: Use envdir or source .env in a wrapper script

; Logging
stdout_logfile=/var/log/fastapi/access.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
stderr_logfile=/var/log/fastapi/error.log
stderr_logfile_maxbytes=10MB
stderr_logfile_backups=5

; Process management
priority=999
stopwaitsecs=30
stopasgroup=true
killasgroup=true

; Resource limits
; Adjust based on server capacity
;rlimit_nofile=65536
;rlimit_nproc=4096


