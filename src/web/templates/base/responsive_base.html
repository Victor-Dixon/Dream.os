<!DOCTYPE html>
<html lang="en" class="h-100">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="description" content="{% block meta_description %}Agent_Cellphone_V2 TDD Integration - Responsive Web Development Framework{% endblock %}">
    <meta name="keywords" content="{% block meta_keywords %}web development, responsive design, TDD, testing, automation{% endblock %}">
    <meta name="author" content="Web Development & UI Framework Specialist">

    <!-- Title -->
    <title>{% block title %}Agent_Cellphone_V2 - TDD Integration{% endblock %}</title>

    <!-- Preconnect to external domains for performance -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- CSS Framework -->
    {% include 'partials/responsive_css.html' %}

    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">

    <!-- Additional CSS -->
    {% block additional_css %}{% endblock %}

    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='images/favicon.ico') }}">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#3498db">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="apple-mobile-web-app-title" content="Agent_Cellphone_V2">

    <!-- Open Graph Meta Tags -->
    <meta property="og:title" content="{% block og_title %}Agent_Cellphone_V2 - TDD Integration{% endblock %}">
    <meta property="og:description" content="{% block og_description %}Comprehensive web development environment with responsive design and TDD integration{% endblock %}">
    <meta property="og:type" content="website">
    <meta property="og:url" content="{{ request.url }}">
    <meta property="og:site_name" content="Agent_Cellphone_V2">

    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="{% block twitter_title %}Agent_Cellphone_V2 - TDD Integration{% endblock %}">
    <meta name="twitter:description" content="{% block twitter_description %}Comprehensive web development environment with responsive design and TDD integration{% endblock %}">

    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "WebApplication",
        "name": "Agent_Cellphone_V2",
        "description": "TDD Integration Web Development Environment",
        "url": "{{ request.url_root }}",
        "applicationCategory": "DeveloperApplication",
        "operatingSystem": "Web Browser"
    }
    </script>

    {% block head_scripts %}{% endblock %}
</head>
<body class="d-flex flex-column h-100">
    <!-- Skip Navigation Link for Accessibility -->
    <a class="visually-hidden-focusable btn btn-primary position-absolute" href="#main-content" style="top: 1rem; left: 1rem; z-index: 1100;">
        Skip to main content
    </a>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="position-fixed top-0 start-0 w-100 h-100 bg-white d-flex align-items-center justify-content-center" style="z-index: 9999;">
        <div class="text-center">
            <div class="spinner mb-3"></div>
            <p class="text-muted">Loading...</p>
        </div>
    </div>

    <!-- Header/Navigation -->
    <header>
        {% block header %}
        <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
            <div class="container-fluid">
                <!-- Brand -->
                <a class="navbar-brand d-flex align-items-center" href="{{ url_for('index') if url_for else '/' }}">
                    <div class="me-2">
                        <svg width="32" height="32" viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">
                            <rect width="32" height="32" rx="8" fill="#3498db"/>
                            <path d="M8 12h16v8H8z" fill="white"/>
                            <circle cx="16" cy="16" r="2" fill="#3498db"/>
                        </svg>
                    </div>
                    <span class="fw-bold">Agent_Cellphone_V2</span>
                </a>

                <!-- Mobile Menu Toggle -->
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Navigation Links -->
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('index') if url_for else '/' }}">Home</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('test') if url_for else '/test' }}">Testing</a>
                        </li>
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                Components
                            </a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="#buttons">Buttons</a></li>
                                <li><a class="dropdown-item" href="#forms">Forms</a></li>
                                <li><a class="dropdown-item" href="#cards">Cards</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#modals">Modals</a></li>
                            </ul>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('health') if url_for else '/health' }}">Health</a>
                        </li>
                    </ul>

                    <!-- Right Side Navigation -->
                    <ul class="navbar-nav">
                        <!-- Breakpoint Indicator -->
                        <li class="nav-item">
                            <span class="nav-link" id="breakpoint-indicator">
                                <small class="text-muted">Current: <span id="current-breakpoint">md</span></small>
                            </span>
                        </li>

                        <!-- Theme Toggle -->
                        <li class="nav-item">
                            <button class="btn btn-ghost nav-link" id="theme-toggle" aria-label="Toggle theme">
                                <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/>
                                </svg>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        {% endblock %}
    </header>

    <!-- Main Content Area -->
    <main id="main-content" class="flex-grow-1">
        <!-- Page Title Section -->
        {% block page_header %}
        {% if self.page_title() %}
        <section class="bg-light py-4">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <h1 class="mb-0">{% block page_title %}{% endblock %}</h1>
                        {% if self.page_subtitle() %}
                        <p class="lead mb-0 text-muted">{% block page_subtitle %}{% endblock %}</p>
                        {% endif %}
                    </div>
                </div>
            </div>
        </section>
        {% endif %}
        {% endblock %}

        <!-- Breadcrumb Navigation -->
        {% block breadcrumb %}
        {% if breadcrumbs %}
        <section class="border-bottom">
            <div class="container">
                <nav aria-label="breadcrumb">
                    <ol class="breadcrumb">
                        {% for crumb in breadcrumbs %}
                        <li class="breadcrumb-item{% if loop.last %} active{% endif %}"{% if loop.last %} aria-current="page"{% endif %}>
                            {% if not loop.last and crumb.url %}
                            <a href="{{ crumb.url }}">{{ crumb.title }}</a>
                            {% else %}
                            {{ crumb.title }}
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ol>
                </nav>
            </div>
        </section>
        {% endif %}
        {% endblock %}

        <!-- Flash Messages -->
        {% block flash_messages %}
        <div id="flash-messages">
            {% with messages = get_flashed_messages(with_categories=true) if get_flashed_messages else [] %}
            {% if messages %}
            <div class="container mt-3">
                {% for category, message in messages %}
                <div class="alert alert-{{ 'error' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                    {{ message }}
                    <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                </div>
                {% endfor %}
            </div>
            {% endif %}
            {% endwith %}
        </div>
        {% endblock %}

        <!-- Main Page Content -->
        {% block content %}
        <div class="container my-4">
            <div class="row">
                <div class="col">
                    <!-- Default content area -->
                    <p>Welcome to the Agent_Cellphone_V2 TDD Integration environment!</p>
                </div>
            </div>
        </div>
        {% endblock %}
    </main>

    <!-- Footer -->
    <footer class="bg-dark text-light py-4 mt-auto">
        {% block footer %}
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>Agent_Cellphone_V2</h5>
                    <p class="text-muted">TDD Integration Web Development Environment</p>
                    <p class="small text-muted mb-0">
                        Built with responsive design principles and modern web technologies.
                    </p>
                </div>
                <div class="col-md-3">
                    <h6>Features</h6>
                    <ul class="list-unstyled small">
                        <li><a href="#" class="text-muted text-decoration-none">Flask Framework</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">FastAPI Integration</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Selenium Testing</a></li>
                        <li><a href="#" class="text-muted text-decoration-none">Responsive Design</a></li>
                    </ul>
                </div>
                <div class="col-md-3">
                    <h6>Development</h6>
                    <ul class="list-unstyled small">
                        <li><a href="/health" class="text-muted text-decoration-none">Health Check</a></li>
                        <li><a href="/test" class="text-muted text-decoration-none">Test Suite</a></li>
                        <li><a href="/docs" class="text-muted text-decoration-none">Documentation</a></li>
                        <li><a href="https://github.com" class="text-muted text-decoration-none">Source Code</a></li>
                    </ul>
                </div>
            </div>
            <hr class="my-3">
            <div class="row align-items-center">
                <div class="col-md-6">
                    <p class="small mb-0 text-muted">
                        &copy; 2024 Agent_Cellphone_V2 TDD Integration Project.
                        Built by Web Development & UI Framework Specialist.
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <p class="small mb-0 text-muted">
                        Version 2.0.0 |
                        <span id="current-time"></span>
                    </p>
                </div>
            </div>
        </div>
        {% endblock %}
    </footer>

    <!-- Back to Top Button -->
    <button id="back-to-top" class="btn btn-primary position-fixed bottom-0 end-0 m-3 rounded-circle" style="width: 50px; height: 50px; display: none; z-index: 1000;" aria-label="Back to top">
        <svg width="20" height="20" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd" d="M3.293 9.707a1 1 0 010-1.414l6-6a1 1 0 011.414 0l6 6a1 1 0 01-1.414 1.414L11 5.414V17a1 1 0 11-2 0V5.414L4.707 9.707a1 1 0 01-1.414 0z" clip-rule="evenodd"/>
        </svg>
    </button>

    <!-- Core JavaScript -->
    {% include 'partials/responsive_js.html' %}

    <!-- Additional JavaScript -->
    {% block additional_js %}{% endblock %}

    <!-- Page-specific JavaScript -->
    {% block page_scripts %}{% endblock %}

    <!-- Framework Enhancement Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Hide loading overlay
            setTimeout(() => {
                const loadingOverlay = document.getElementById('loading-overlay');
                if (loadingOverlay) {
                    loadingOverlay.style.opacity = '0';
                    setTimeout(() => {
                        loadingOverlay.style.display = 'none';
                    }, 300);
                }
            }, 500);

            // Update current time
            function updateTime() {
                const timeElement = document.getElementById('current-time');
                if (timeElement) {
                    timeElement.textContent = new Date().toLocaleTimeString();
                }
            }
            updateTime();
            setInterval(updateTime, 1000);

            // Breakpoint indicator
            function updateBreakpointIndicator() {
                const indicator = document.getElementById('current-breakpoint');
                if (indicator && window.ResponsiveFramework) {
                    indicator.textContent = ResponsiveFramework.utils.getCurrentBreakpoint();
                }
            }

            // Listen for breakpoint changes
            if (window.ResponsiveFramework) {
                ResponsiveFramework.events.on('breakpoint.change', updateBreakpointIndicator);
                updateBreakpointIndicator();
            }

            // Back to top button
            const backToTopBtn = document.getElementById('back-to-top');
            if (backToTopBtn) {
                window.addEventListener('scroll', () => {
                    if (window.pageYOffset > 300) {
                        backToTopBtn.style.display = 'block';
                    } else {
                        backToTopBtn.style.display = 'none';
                    }
                });

                backToTopBtn.addEventListener('click', () => {
                    window.scrollTo({
                        top: 0,
                        behavior: 'smooth'
                    });
                });
            }

            // Theme toggle functionality
            const themeToggle = document.getElementById('theme-toggle');
            if (themeToggle) {
                themeToggle.addEventListener('click', () => {
                    document.body.classList.toggle('dark-theme');

                    // Save preference
                    const isDark = document.body.classList.contains('dark-theme');
                    localStorage.setItem('theme', isDark ? 'dark' : 'light');
                });

                // Load saved theme
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme === 'dark') {
                    document.body.classList.add('dark-theme');
                }
            }

            // Enhanced form validation
            const forms = document.querySelectorAll('.needs-validation');
            forms.forEach(form => {
                form.addEventListener('submit', (event) => {
                    if (!form.checkValidity()) {
                        event.preventDefault();
                        event.stopPropagation();

                        // Focus first invalid field
                        const firstInvalid = form.querySelector(':invalid');
                        if (firstInvalid) {
                            firstInvalid.focus();
                        }
                    }

                    form.classList.add('was-validated');
                });
            });

            // Auto-hide flash messages
            const alerts = document.querySelectorAll('.alert:not(.alert-persistent)');
            alerts.forEach(alert => {
                setTimeout(() => {
                    if (alert.parentNode) {
                        alert.classList.remove('show');
                        setTimeout(() => {
                            alert.remove();
                        }, 300);
                    }
                }, 5000);
            });

            // Console log for development
            console.log('ðŸš€ Agent_Cellphone_V2 TDD Integration Environment');
            console.log('ðŸ“± Responsive Framework Loaded');
            console.log('ðŸ§ª Testing Infrastructure Ready');
        });

        // Performance monitoring
        window.addEventListener('load', () => {
            if ('performance' in window) {
                const loadTime = performance.timing.loadEventEnd - performance.timing.navigationStart;
                console.log(`Page loaded in ${loadTime}ms`);
            }
        });

        // Service Worker registration (if available)
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('SW registered: ', registration);
                    })
                    .catch(registrationError => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }
    </script>

    <!-- Analytics and Monitoring -->
    {% block analytics %}
    <!-- Add your analytics code here -->
    {% endblock %}

    <!-- Accessibility Enhancements -->
    <div class="visually-hidden" aria-live="polite" aria-atomic="true" id="screen-reader-announcements"></div>
</body>
</html>
